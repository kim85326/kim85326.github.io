---
layout: post
title: "佈署虛擬機 Centos7 的開發環境設定"
date: 2018-11-23 00:00:00 +0800
categories: 作業系統
tags: 作業系統 Linux
mathjax: true
---

本文件基於以下 OS 版本設定環境

- `CentOS Linux release 7.4.1708`的`DVD ISO`版

### 開啟網卡和調整開機預設啟動網卡

預設網卡是關閉的，需先開啟

`$ sudo ifup ens33`

輸入以下指令，即可看到這台VM分配到的內網 IP

`$ ip addr`

從外部機器 (MAC 或 Window) 即可直接在終端機透過 IP 登入 VM

再調整以下設定，令開機後自動啟用該網卡

`$ sudo vi /etc/sysconfig/network-scripts/ifcfg-ens33`

- `ONBOOT=yes`

### 安裝所需套件

以下在其他文件已有教學

nginx: 

- [文件link](../LNMP/nginx.md)

php7.0: 

- [文件link](../php/php7.0.md)

mysql(mariadb): 

先更新預設 mysql-server 安裝的版本由 5.5 升到 5.6 以上

`$ sudo rpm -Uvh http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm`

之後 mysql-server 安裝步驟跟以下文件內容一樣

- [文件link](../db/centos-mysql-default-install.md)

### 開啟防火牆 80、443 port 給外部機器可連

`$ sudo firewall-cmd --zone=public --add-port=80/tcp --permanent;`

`$ sudo firewall-cmd --zone=public --add-port=443/tcp --permanent;`

`$ sudo firewall-cmd --reload;`

### 共用資料夾

舉例:先在 vmware 程式裡設共用資料夾 `project-test`

在 VM 上安裝套件

`$ sudo yum install open-vm-tools`

`$ sudo mkdir /tmp/test-dir`

掛載資料夾，以下掛載後的資料夾權限用root舉例

可以輸入`$ cat /etc/passwd`來看各個帳號的 uid、gid 設定來調整自己的語法

或是用`id -u [使用者帳號]`可以直接查 uid，用`id -g [使用者帳號]`可以直接查 gid

`$ sudo vmhgfs-fuse .host:/project-test /tmp/test-dir -o subtype=vmhgfs-fuse,allow_other,rw,uid=$(id -u root),gid=$(id -g root)`

sudo vmhgfs-fuse .host:centos-project /home/elaine_li/projects -o subtype=vmhgfs-fuse,allow_other,rw,uid=$(id -u root),gid=$(id -g root)

### 開機自動執行指令

`$ sudo vi /etc/rc.local`

預設內容如下

    #!/bin/bash
    # THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES
    #
    # It is highly advisable to create own systemd services or udev rules
    # to run scripts during boot instead of using this file.
    #
    # In contrast to previous versions due to parallel execution during boot
    # this script will NOT be run after all other services.
    #
    # Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure
    # that this script will be executed during boot.
    
    touch /var/lock/subsys/local

將你想要開機自動執行的指令補在檔案裡

例如之前的共用資料夾指令

    #!/bin/bash
    # THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES
    #
    # It is highly advisable to create own systemd services or udev rules
    # to run scripts during boot instead of using this file.
    #
    # In contrast to previous versions due to parallel execution during boot
    # this script will NOT be run after all other services.
    #
    # Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure
    # that this script will be executed during boot.
    
    touch /var/lock/subsys/local
    vmhgfs-fuse .host:/project-test /tmp/test-dir -o subtype=vmhgfs-fuse,allow_other,rw,uid=$(id -u root),gid=$(id -g root)

再將檔案開啟可執行權限即可

`$ sudo chmod +x /etc/rc.local`

之後開機便會自動執行指令